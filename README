### MARC bibliographic record to RDF converter
### Ruby script using YAML mapping

# Purpose: Convert binary marc to semantic markup using yaml mapping file
# Creator: Benjamin Rokseth
# Date: 10.07.2011

## FILES ##
normarc2rdf.rb                            -- main ruby script to convert NORMARC file to RDF
config/config-dist.yml                    -- config file
config/mapping-normarc2rdf.yml            -- example mapping file: NORMARC tags to rdf mapping
config/mapping-normarc2rdf_bildebaser.yml -- example mapping file: image base in NORMARC
hamsun_fikset.mrc                         -- test NORMARC file
output.rdf                                -- test output RDF with -r 50 (50 records)
output.nt                                 -- test output NTRIPLES with -r 50 (50 records)

## MAPPING ##
uses yaml hashes mapping
excerpt:
-----
tag:
  "700": 
    subfield: 
      a:
        conditions:
          subfield:
            e:
              orig: "bearb|biogr|dir|forf|fort|foto|gjendikt|overs|ill|innl|k|komm|komp|manus|medarb|medf|oppl|red|reg|sang|skues|t|tekstf|utg|utøv"
              subs: { bearb: 'http://purl.org/dc/terms/contributor', biogr: 'http://rdf.deichman.no/biographer', dir: 'http://rdf.deichman.no/director', forf: 'http://purl.org/dc/terms/creator', fort: 'http://purl.org/dc/terms/narrator', foto: 'http://rdf.deichman.no/photographer', gjendikt: 'http://purl.org/ontology/bibo/translator', overs: 'http://purl.org/ontology/bibo/translator', ill: 'http://purl.org/ontology/bibo/illustrator', innl: 'http://rdf.deichman.no/reader', k: 'http://rdf.deichman.no/composer', komm: 'http://rdf.deichman.no/commentator', komp: 'http://rdf.deichman.no/composer', manus: 'http://rdf.deichman.no/scriptWriter', medarb: 'http://purl.org/dc/terms/contributor', medf: 'http://purl.org/dc/terms/contributor', oppl: 'http://purl.org/dc/terms/narrator', red: 'http://purl.org/ontology/bibo/editor', reg: 'http://rdf.deichman.no/director', sang: 'http://rdf.deichman.no/singer', skues: 'http://rdf.deichman.no/actor', t: 'http://rdf.deichman.no/lyricWriter', tekstf: 'http://rdf.deichman.no/lyricWriter', utg: 'http://rdf.deichman.no/publisher', utøv: 'http://rdf.deichman.no/perfomer' }
              default: 'http://purl.org/dc/terms/contributor'
        object:
          combine:
            - a
            - b
            - d
          combinestring: "_" 
          regex_replace: "Å|Ø|Æ|å|ø|æ|Ä|Ö|ä|ö|\ |[éèêẽ]|[áàâã]|[íìîĩ]|[óòôõ]|[úùûũ]"
          regex_strip: "[^\w\-]+"
          prefix: http://rdf.deichman.no/person/
          datatype: uri
        relation: 
          class: "http://xmlns.com/foaf/0.1/Person"
          subfield:
            a:
              predicate: "http://xmlns.com/foaf/0.1/name"
              object:
                datatype: literal
 
------
## FEATURES ##
For full list of functions see example YAML file 'config/mapping-normarc2rdf.yml'

tag numbers can be regex (e.g. "^5(?!71)" for 500-599 minus 571)
all uris are exploded in yaml file, and objects need full prefix 
predicates can be conditionally mapped from subfields or indicators
objects can have language tags given as symbols (:se :en_UK etc)
objects can be mapped key => values
relations can have subfields
string replacement characters can be given individually in yaml objects 
  main list under substitutes: {'Æ': Ae,  'Ø': Oe,  'Å': Aa, ... }


## TODO ##
relation subfield relations should accept different classes

## REQUIREMENTS ##
ruby >= 1.8.7
ruby-marc (thanks to Ross Singer et.al.)
rdf.rb (thanks to Arto Bendiken et.al. for the brilliant RDF library for ruby)
rdf-rdfxml.rb (requires development libraries libxml2 and libxslt1)

## LINUX USERS ##
either install via rvm (Ruby Version Manager)
or install ruby-dev

## UBUNTU INSTALL ##
(for rdf-xml support)
sudo apt-get install libxml2-dev libxslt1-dev
gem install marc rdf rdf-rdfxml

## USAGE ##
normarc2rdf.rb -i input_file -o output_file [-r recordlimit]
  -i input_file must be marc binary
  -o output_file extension can be either .rdf (slooow) or .nt (very fast)
  -r [number] stops processing after given number of records
